<main>
    <div class="habits-today">
        <% if (habits.length > 0) { %>
            <% habits.forEach(habit => { %>
                <div class="habit">
                    <input type="checkbox" name="habit-checkbox" id="habit-checkbox-<%= habit.id %>" 
                           data-habit-id="<%= habit.id %>" onclick="updateHabitStatus(this)">
                    <p><%= habit.text %></p>
                    <p><%= habit.xp %> xp</p>
                </div>
            <% }) %>
        <% } %>
    </div>
</main>

<script>
    async function updateHabitStatus(checkbox) {
        const habitId = checkbox.getAttribute('data-habit-id');
        const isChecked = checkbox.checked;

        try {
            const response = await fetch('/update-habit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ habitId, isChecked }),
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            console.log(data.message); // Handle success message from the server

        } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
        }
    }
</script>